"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _default;

var _utils = require("../utils");

var _exception = _interopRequireDefault(require("../exception"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _default(instance) {
  instance.registerHelper('with', function (context, options) {
    if (arguments.length != 2) {
      throw new _exception["default"]('#with requires exactly one argument');
    }

    if ((0, _utils.isFunction)(context)) {
      context = context.call(this);
    }

    var fn = options.fn;

    if (!(0, _utils.isEmpty)(context)) {
      var data = options.data;

      if (options.data && options.ids) {
        data = (0, _utils.createFrame)(options.data);
        data.contextPath = (0, _utils.appendContextPath)(options.data.contextPath, options.ids[0]);
      }

      return fn(context, {
        data: data,
        blockParams: (0, _utils.blockParams)([context], [data && data.contextPath])
      });
    } else {
      return options.inverse(this);
    }
  });
}